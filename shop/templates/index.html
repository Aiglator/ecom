<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste des Produits</title>
</head>
<body>
    {% include 'nav.html' %}

    <!-- üîç Formulaire de recherche et filtres -->
    <form id="filterForm" action="{% url 'index' %}" method="GET">
        <input type="text" id="search" name="q" placeholder="Rechercher un produit..." value="{{ query }}">

        <label for="min_price">Prix min :</label>
        <input type="number" id="min_price" name="min_price" value="{{ min_price }}">

        <label for="max_price">Prix max :</label>
        <input type="number" id="max_price" name="max_price" value="{{ max_price }}">

        <label for="size">Taille :</label>
        <select name="size" id="size">
            <option value="">Toutes</option>
            {% for size_code, size_label in size_choices %}
                <option value="{{ size_code }}" {% if size_code == size_filter %}selected{% endif %}>
                    {{ size_label }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">üîç Filtrer</button>
        <a href="{% url 'index' %}">üîÑ R√©initialiser</a>
    </form>

    <main>
        <h1>Produits</h1>

        {% if product %}
            <!-- üî• Affichage d'un produit sp√©cifique -->
            <h2>{{ product.name }}</h2>
            <p><strong>Prix :</strong> {{ product.price }}‚Ç¨</p>
            <p><strong>Description :</strong> {{ product.description }}</p>

            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" width="200">
            {% endif %}

            <!-- Formulaire d'ajout au panier -->
            <form action="{% url 'add_to_cart' product.id %}" method="post">
                {% csrf_token %}
                <label for="size"><strong>Taille :</strong></label>
                <select name="size" id="size" required>
                    {% for size_code, size_label in size_choices %}
                        <option value="{{ size_code }}">{{ size_label }}</option>
                    {% endfor %}
                </select>

                <label for="quantity"><strong>Quantit√© :</strong></label>
                <input type="number" name="quantity" id="quantity" min="1" value="1" required>

                <br><br>
                <button type="submit">Ajouter au Panier</button>
            </form>

            <br>
            <a href="{% url 'index' %}">Retour √† la liste des produits</a>

        {% else %}
            <!-- üìå Liste des produits filtr√©s ou recherch√©s -->
            {% if products %}
                <ul>
                    {% for product in products %}
                        <li>
                            <a href="{% url 'index' %}?id={{ product.id }}">
                                <strong>{{ product.name }}</strong> - {{ product.price }}‚Ç¨
                            </a>
                            {% if product.image %}
                                <br>
                                <img src="{{ product.image.url }}" width="100" alt="{{ product.name }}">
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Aucun produit trouv√©.</p>
            {% endif %}
        {% endif %}

        <hr>

        <!-- üõí Affichage du panier -->
        <h2>üõí Mon Panier</h2>
        {% if cart and cart.total > 0 %}
            <ul>
                {% for key, item in cart.items %}
                    {% if item.id and item.size %}
                        <li>
                            {{ item.name }} (Taille: {{ item.size }}) - {{ item.quantity }} * {{ item.price }}‚Ç¨ = 
                            <strong>{{ item.total_product_price }}‚Ç¨</strong>
                            <form action="{% url 'remove_from_cart' item.id item.size %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit">‚ùå Supprimer</button>
                            </form>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <p><strong>Total:</strong> {{ cart.total|floatformat:2 }} ‚Ç¨</p>

            <!-- ‚úÖ Bouton "Commander" -->
            <form action="{% url 'checkout' %}" method="GET">
                <button type="submit">üõí Commander</button>
            </form>
        {% else %}
            <p>Votre panier est vide.</p>
        {% endif %}
    </main>
</body>
</html>
